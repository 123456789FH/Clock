<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0ea5e9" />
  <title>ÙˆÙ‚ØªÙŠ ÙÙŠ Ø±Ù…Ø¶Ø§Ù† â€” ØªØ¯Ø±ÙŠØ¨ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø³Ø§Ø¹Ø©</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --brand:#0ea5e9;   /* Ø£Ø²Ø±Ù‚ */
      --brand2:#22c55e;  /* Ø£Ø®Ø¶Ø± */
      --ink:#0f172a;
      --muted:#64748b;
      --bg:#f6f8fc;
      --card:#ffffff;
      --shadow: 0 14px 36px rgba(2,8,23,.10);
      --radius:18px;
    }
    *{ box-sizing:border-box; font-family:"Tajawal",system-ui,-apple-system,Segoe UI,Arial; }
    body{
      margin:0;
      background:
        radial-gradient(1000px 650px at 18% 10%, rgba(14,165,233,.18), transparent 60%),
        radial-gradient(1000px 650px at 82% 18%, rgba(34,197,94,.15), transparent 58%),
        linear-gradient(180deg, #ffffff, var(--bg));
      color:var(--ink);
    }
    .wrap{ max-width:1120px; margin:22px auto; padding:0 16px 96px; }

    /* Header */
    .top{
      display:flex; gap:14px; align-items:center; justify-content:space-between; flex-wrap:wrap;
      padding:16px 16px; border-radius:var(--radius);
      background:linear-gradient(135deg, rgba(14,165,233,.14), rgba(34,197,94,.12));
      border:1px solid rgba(2,8,23,.06);
      box-shadow: 0 10px 26px rgba(2,8,23,.06);
    }
    .title{ display:flex; gap:12px; align-items:center; }
    .logo{
      width:60px; height:60px; border-radius:18px;
      object-fit:contain;
      background:#fff;
      border:1px solid rgba(2,8,23,.08);
      box-shadow: var(--shadow);
      padding:7px;
      flex:0 0 auto;
    }
    h1{ font-size:20px; margin:0 0 4px; font-weight:900; }
    .sub{ margin:0; color:var(--muted); font-size:14px; line-height:1.7; }

    .row{ display:grid; grid-template-columns: 1.05fr .95fr; gap:16px; margin-top:16px; }
    @media (max-width: 950px){ .row{ grid-template-columns:1fr; } }

    .card{
      background:var(--card); border-radius:var(--radius);
      border:1px solid rgba(2,8,23,.06); box-shadow:var(--shadow);
      padding:16px;
    }

    .pill{
      display:inline-flex; gap:8px; align-items:center;
      background:rgba(2,8,23,.04); border:1px solid rgba(2,8,23,.06);
      padding:8px 10px; border-radius:999px; font-size:13px; color:var(--muted);
      white-space:nowrap;
    }

    .grid2{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    @media (max-width: 520px){ .grid2{ grid-template-columns:1fr; } }

    .select, .input{
      width:100%; padding:10px 12px; border-radius:14px;
      border:1px solid rgba(2,8,23,.14);
      outline:none; background:#fff; font-weight:700;
    }
    .label{ font-weight:900; font-size:13px; margin:0 0 6px; color:rgba(2,8,23,.75); }

    .tabs{ display:flex; gap:8px; flex-wrap:wrap; }
    .tab{
      border:1px solid rgba(2,8,23,.10);
      background:#fff; color:var(--ink);
      padding:10px 12px; border-radius:999px;
      cursor:pointer; font-weight:800; font-size:14px;
      transition: transform .12s ease, background .12s ease;
    }
    .tab:hover{ transform: translateY(-1px); }
    .tab.active{
      background:linear-gradient(135deg, rgba(14,165,233,.14), rgba(34,197,94,.12));
      border-color: rgba(14,165,233,.35);
    }

    .muted{ color:var(--muted); font-size:13px; line-height:1.8; }

    .btn{
      border:none; cursor:pointer; border-radius:14px; padding:10px 12px;
      font-weight:900; background:linear-gradient(135deg, var(--brand), var(--brand2));
      color:white; box-shadow: 0 12px 20px rgba(14,165,233,.16);
      transition: transform .12s ease;
    }
    .btn:hover{ transform: translateY(-1px); }
    .btn.ghost{
      background:#fff; color:var(--ink);
      border:1px solid rgba(2,8,23,.12); box-shadow:none;
    }
    .btn.small{ padding:8px 10px; border-radius:12px; font-weight:900; }
    .btn:disabled{ opacity:.6; cursor:not-allowed; transform:none; }

    .hr{ height:1px; background:rgba(2,8,23,.06); margin:14px 0; }

    .box{
      background: rgba(2,8,23,.03);
      border: 1px dashed rgba(2,8,23,.18);
      padding:12px; border-radius:16px;
    }

    /* Clock */
    .clock-wrap{ display:flex; gap:14px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
    .clock{
      width:320px; height:320px; border-radius:50%;
      background:
        radial-gradient(circle at 30% 20%, rgba(255,255,255,.95), rgba(255,255,255,.55)),
        linear-gradient(180deg, #ffffff, #f7fbff);
      border: 10px solid rgba(14,165,233,.18);
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }
    @media (max-width: 520px){ .clock{ width:290px; height:290px; } }
    .ticks{
      position:absolute; inset:0;
      background:
        repeating-conic-gradient(
          from -90deg,
          rgba(2,8,23,.20) 0deg 1deg,
          transparent 1deg 6deg
        );
      mask: radial-gradient(circle at center, transparent 0 74%, black 74% 100%);
      opacity:.33;
    }
    .numbers{ position:absolute; inset:0; }
    .num{
      position:absolute;
      width:36px; height:36px; border-radius:12px;
      display:grid; place-items:center;
      font-weight:900; color:rgba(2,8,23,.72);
      transform: translate(-50%,-50%);
      user-select:none;
    }
    .hand{
      position:absolute;
      left:50%; top:50%;
      transform-origin: 50% 100%;
      border-radius:999px;
      box-shadow: 0 6px 12px rgba(2,8,23,.12);
    }
    .hand.hour{
      width:10px; height:95px;
      background: linear-gradient(180deg, rgba(15,23,42,.95), rgba(15,23,42,.65));
    }
    .hand.minute{
      width:8px; height:130px;
      background: linear-gradient(180deg, rgba(14,165,233,.95), rgba(34,197,94,.75));
    }
    .center-dot{
      position:absolute; left:50%; top:50%;
      width:16px; height:16px; border-radius:50%;
      transform: translate(-50%,-50%);
      background: linear-gradient(135deg, var(--brand), var(--brand2));
      border:3px solid white;
      box-shadow: 0 10px 18px rgba(14,165,233,.18);
      z-index:4;
    }

    .controls{ flex:1; min-width:260px; display:grid; gap:10px; }
    .kpi{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; }
    .digital{
      font-size:28px; font-weight:900; letter-spacing: .5px;
      background: rgba(2,8,23,.04);
      border:1px solid rgba(2,8,23,.06);
      padding:10px 12px; border-radius:16px;
      display:inline-block;
    }
    .feedback{
      padding:10px 12px; border-radius:16px;
      border:1px solid rgba(2,8,23,.08);
      background:rgba(255,255,255,.7);
      min-height:44px;
      line-height:1.9;
      font-weight:700;
    }
    .ok{ border-color: rgba(34,197,94,.35); background: rgba(34,197,94,.10); }
    .bad{ border-color: rgba(239,68,68,.35); background: rgba(239,68,68,.08); }

    /* Plan table */
    table{ width:100%; border-collapse:separate; border-spacing:0 10px; }
    th{ text-align:right; color:rgba(2,8,23,.70); font-size:13px; }
    td{ background:#fff; border:1px solid rgba(2,8,23,.08); padding:10px; border-radius:14px; }
    .mini{ font-size:12px; color:var(--muted); }

    footer{
      position:fixed; left:0; right:0; bottom:0;
      background: rgba(255,255,255,.88);
      border-top: 1px solid rgba(2,8,23,.08);
      backdrop-filter: blur(10px);
      padding:10px 14px;
      display:flex; gap:10px; justify-content:space-between; align-items:center; flex-wrap:wrap;
      font-size:13px; color:rgba(2,8,23,.70);
      z-index: 10;
    }
    footer b{ color:rgba(2,8,23,.88); }

    /* Certificate modal */
    .modal{
      position:fixed; inset:0;
      background: rgba(2,8,23,.55);
      display:none;
      align-items:center; justify-content:center;
      padding:18px;
      z-index: 9999;
    }
    .modal.show{ display:flex; }
    .cert{
      width:min(920px, 100%);
      background:
        radial-gradient(900px 600px at 15% 15%, rgba(14,165,233,.18), transparent 65%),
        radial-gradient(900px 600px at 85% 20%, rgba(34,197,94,.16), transparent 60%),
        linear-gradient(180deg, #ffffff, #f8fbff);
      border-radius: 26px;
      border: 1px solid rgba(2,8,23,.08);
      box-shadow: 0 22px 60px rgba(2,8,23,.18);
      overflow:hidden;
    }
    .cert-head{
      padding:18px 20px;
      display:flex; gap:14px; align-items:center; justify-content:space-between; flex-wrap:wrap;
      border-bottom:1px solid rgba(2,8,23,.06);
      background: rgba(255,255,255,.75);
      backdrop-filter: blur(10px);
    }
    .cert-brand{ display:flex; gap:12px; align-items:center; }
    .cert-brand img{
      width:54px; height:54px; border-radius:16px; object-fit:contain;
      background:#fff; padding:6px; border:1px solid rgba(2,8,23,.08);
    }
    .cert-body{ padding:24px 22px 18px; }
    .cert-title{ font-size:34px; font-weight:900; margin:0 0 8px; }
    .cert-sub{ margin:0 0 18px; color:rgba(2,8,23,.65); font-weight:800; line-height:1.9; }
    .cert-name{
      margin:18px 0 10px; font-size:28px; font-weight:900;
      padding:14px 16px; border-radius:18px;
      background: rgba(2,8,23,.03);
      border:1px dashed rgba(2,8,23,.18);
    }
    .cert-grid{ display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:14px; }
    @media (max-width:700px){ .cert-grid{ grid-template-columns:1fr; } }
    .cert-kpi{
      padding:12px 14px; border-radius:18px;
      border:1px solid rgba(2,8,23,.08);
      background:#fff;
      display:flex; justify-content:space-between; gap:10px; align-items:center;
      font-weight:900;
    }
    .cert-foot{
      padding:14px 18px 18px;
      display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;
      border-top:1px solid rgba(2,8,23,.06);
      background: rgba(255,255,255,.75);
    }
    .cert-sign{ color:rgba(2,8,23,.72); font-weight:900; }

    /* Print */
    @media print{
      .wrap, footer{ display:none !important; }
      body{ background:#fff; }
      .modal{ position:static; inset:auto; display:block !important; background:#fff !important; padding:0 !important; }
      .cert{ box-shadow:none !important; border:1px solid #ddd !important; }
      .cert-head{ border-bottom:1px solid #ddd !important; }
      .cert-foot{ border-top:1px solid #ddd !important; }
      #closeCert{ display:none !important; }
      #copyResult{ display:none !important; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="title">
        <img class="logo" id="logoImg" alt="Ø´Ø¹Ø§Ø± Ù…Ù„ØªÙ‚Ù‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ" />
        <div>
          <h1>ÙˆÙ‚ØªÙŠ ÙÙŠ Ø±Ù…Ø¶Ø§Ù† â€” ØªØ¯Ø±ÙŠØ¨ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø³Ø§Ø¹Ø© + Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚Øª</h1>
          <p class="sub">Ø¨Ø±Ù†Ø§Ù…Ø¬ ØµØºÙŠØ± Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«: Ù†Ù‚Ø±Ø£ Ø§Ù„Ø³Ø§Ø¹Ø© ÙˆÙ†Ø±Ø¨Ø·Ù‡Ø§ Ø¨Ø¹Ø¨Ø§Ø¯Ø§Øª Ø±Ù…Ø¶Ø§Ù† ÙˆØ£Ø¹Ù…Ø§Ù„ Ø§Ù„ÙŠÙˆÙ…. âœ¨</p>
        </div>
      </div>

      <div style="min-width:260px; display:grid; gap:10px;">
        <div class="pill">ğŸ•’ <span>â€œÙˆØ§Ù„Ø¹ØµØ±â€ ØªØ°ÙƒÙŠØ± Ø¨Ø£Ù† Ø§Ù„ÙˆÙ‚Øª Ø«Ù…ÙŠÙ†</span></div>
        <div class="grid2">
          <div>
            <div class="label">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</div>
            <input id="studentName" class="input" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ù‡Ù†Ø§â€¦" />
          </div>
          <div>
            <div class="label">Ø¯Ù‚Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨</div>
            <select id="difficulty" class="select">
              <option value="hour">Ø¹Ù„Ù‰ Ø±Ø£Ø³ Ø§Ù„Ø³Ø§Ø¹Ø©</option>
              <option value="half">Ù†ØµÙ Ø³Ø§Ø¹Ø©</option>
              <option value="quarter" selected>Ø£Ø±Ø¨Ø§Ø¹ Ø§Ù„Ø³Ø§Ø¹Ø©</option>
              <option value="five">ÙƒÙ„ Ù¥ Ø¯Ù‚Ø§Ø¦Ù‚</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <!-- Left -->
      <div class="card">
        <div class="tabs">
          <button class="tab active" data-tab="game">ğŸ¯ ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ø³Ø§Ø¹Ø©</button>
          <button class="tab" data-tab="plan">ğŸ“… Ø¬Ø¯ÙˆÙ„ÙŠ Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠ</button>
          <button class="tab" data-tab="teacher">ğŸ§‘â€ğŸ« ÙÙƒØ±Ø© ØªØ±Ø¨ÙˆÙŠØ©</button>
        </div>

        <!-- Game -->
        <div id="tab-game" class="tab-panel" style="margin-top:14px;">
          <div class="muted">
            Ø§Ø¶Ø¨Ø· Ø§Ù„Ø¹Ù‚Ø§Ø±Ø¨ Ø¹Ù„Ù‰ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨. ÙƒÙ„ Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© ØªÙƒØ³Ø¨Ùƒ Ù†Ù‚Ø·Ø©.
            <b>ØªÙ†Ø¨ÙŠÙ‡:</b> Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ù‡Ù†Ø§ Ø£Ù…Ø«Ù„Ø© Ù„Ù„ØªØ¹Ù„Ù… ÙˆÙ„ÙŠØ³Øª Ù…ÙˆØ§Ù‚ÙŠØª Ø±Ø³Ù…ÙŠØ© Ù„Ù„ØµÙ„Ø§Ø©.
          </div>

          <div class="hr"></div>

          <div class="kpi">
            <div class="pill">ğŸ“Œ Ø§Ù„Ø³Ø¤Ø§Ù„: <b id="qNow">Ù </b>/<b id="qTotal">Ù¡Ù </b></div>
            <div class="pill">â­ Ø§Ù„Ø¯Ø±Ø¬Ø©: <b id="score">Ù </b></div>
            <div class="pill">ğŸ† Ø£ÙØ¶Ù„ Ù†ØªÙŠØ¬Ø©: <b id="best">Ù </b></div>
          </div>

          <div class="hr"></div>

          <div class="box">
            <div class="label">Ø§Ù„Ù…Ù‡Ù…Ø©</div>
            <div style="font-size:16px; font-weight:900; line-height:1.8;" id="prompt">Ø§Ø¶ØºØ· â€œØ§Ø¨Ø¯Ø£â€ Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªØ¯Ø±ÙŠØ¨.</div>
            <div class="mini" id="hint" style="margin-top:6px;">ØªÙ„Ù…ÙŠØ­: Ø§Ù„Ø¹Ù‚Ø±Ø¨ Ø§Ù„Ø·ÙˆÙŠÙ„ Ù„Ù„Ø¯Ù‚Ø§Ø¦Ù‚ØŒ ÙˆØ§Ù„Ù‚ØµÙŠØ± Ù„Ù„Ø³Ø§Ø¹Ø§Øª.</div>

            <div class="hr"></div>

            <div class="clock-wrap">
              <div class="clock" id="clock">
                <div class="ticks"></div>
                <div class="numbers" id="clockNumbers"></div>
                <div class="hand hour" id="hourHand"></div>
                <div class="hand minute" id="minuteHand"></div>
                <div class="center-dot"></div>
              </div>

              <div class="controls">
                <div>
                  <div class="label">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø°ÙŠ Ø§Ø®ØªØ±ØªÙ‡</div>
                  <div class="digital" id="digitalPreview">Ù Ù :Ù Ù </div>
                </div>

                <div class="grid2">
                  <button class="btn small ghost" id="hourDown">âˆ’ Ø³Ø§Ø¹Ø©</button>
                  <button class="btn small ghost" id="hourUp">+ Ø³Ø§Ø¹Ø©</button>
                </div>

                <div class="grid2">
                  <button class="btn small ghost" id="minDown">âˆ’ Ø¯Ù‚Ø§Ø¦Ù‚</button>
                  <button class="btn small ghost" id="minUp">+ Ø¯Ù‚Ø§Ø¦Ù‚</button>
                </div>

                <div class="grid2">
                  <button class="btn small" id="startBtn">Ø§Ø¨Ø¯Ø£</button>
                  <button class="btn small ghost" id="resetBtn">Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button>
                </div>

                <div class="grid2">
                  <button class="btn small" id="checkBtn" disabled>ØªØ­Ù‚Ù‚</button>
                  <button class="btn small ghost" id="nextBtn" disabled>Ø§Ù„ØªØ§Ù„ÙŠ</button>
                </div>

                <div class="grid2">
                  <button class="btn small ghost" id="certBtn" style="display:none;">ğŸ… Ø´Ù‡Ø§Ø¯Ø© Ø¥Ù†Ø¬Ø§Ø²</button>
                  <button class="btn small ghost" id="copyResult" style="display:none;">Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
                </div>

                <div class="feedback" id="feedback">Ø¬Ø§Ù‡Ø²ØŸ Ø§Ø¶ØºØ· â€œØ§Ø¨Ø¯Ø£â€.</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Plan -->
        <div id="tab-plan" class="tab-panel" style="display:none; margin-top:14px;">
          <div class="muted">
            Ø§ÙƒØªØ¨ Ø¬Ø¯ÙˆÙ„Ùƒ Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠ (Ø£ÙˆÙ‚Ø§Øª ØªÙ‚Ø±ÙŠØ¨ÙŠØ©) Ø«Ù… Ø§Ø­ÙØ¸Ù‡ Ø£Ùˆ Ø§Ø·Ø¨Ø¹Ù‡.
            Ù‡Ø°Ø§ ÙŠØ³Ø§Ø¹Ø¯Ùƒ ØªØ±Ø¨Ø· <b>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚Øª</b> Ø¨Ù€ <b>Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ø¹Ø¨Ø§Ø¯Ø§Øª</b>.
          </div>

          <div class="hr"></div>

          <div class="box">
            <div class="label">Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ù‡Ù…Ø©</div>
            <div class="muted">Ø¹Ø¯Ù‘Ù„ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø­Ø³Ø¨ Ù…Ø¯ÙŠÙ†ØªÙƒ ÙˆÙ…Ø¯Ø±Ø³ØªÙƒ. Ø§Ù„Ù‡Ø¯Ù Ù‡Ù†Ø§: ØªØ¯Ø±ÙŠØ¨ Ø¹Ù„Ù‰ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø³Ø§Ø¹Ø© ÙˆØªÙ†Ø¸ÙŠÙ… Ø§Ù„ÙŠÙˆÙ….</div>
          </div>

          <div class="hr"></div>

          <div class="box">
            <div class="label">Ø¬Ø¯ÙˆÙ„ÙŠ Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠ</div>
            <div class="mini" style="margin-bottom:10px;">Ø§Ø®ØªØ± Ø³Ø§Ø¹Ø©/Ø¯Ù‚ÙŠÙ‚Ø© Ù„ÙƒÙ„ Ù†Ø´Ø§Ø· Ø«Ù… â€œØ­ÙØ¸ Ø§Ù„Ø¬Ø¯ÙˆÙ„â€.</div>

            <div style="overflow:auto;">
              <table id="planTable">
                <thead>
                  <tr>
                    <th style="width:40%;">Ø§Ù„Ù†Ø´Ø§Ø·</th>
                    <th>Ø§Ù„Ø³Ø§Ø¹Ø©</th>
                    <th>Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>

            <div class="grid2">
              <button class="btn" id="savePlan">Ø­ÙØ¸ Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>
              <button class="btn ghost" id="printPlan">Ø·Ø¨Ø§Ø¹Ø©</button>
            </div>

            <div class="hr"></div>

            <div class="box">
              <div class="label">Ù‚Ø§Ø¹Ø¯Ø© Ø°Ù‡Ø¨ÙŠØ© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚Øª</div>
              <div class="muted">
                Ù¡) Ø£Ø¨Ø¯Ø£ Ø¨Ø§Ù„ÙØ±Ø§Ø¦Ø¶. Ù¢) Ø£Ø­Ø¯Ø¯ ÙˆÙ‚ØªÙ‹Ø§ Ù„Ù„Ù‚Ø±Ø¢Ù†. Ù£) Ø£Ø¶Ø¹ ÙˆÙ‚ØªÙ‹Ø§ Ù„Ù„Ù…Ø°Ø§ÙƒØ±Ø© ÙˆØ§Ù„Ø±Ø§Ø­Ø©. Ù¤) Ø£ØªØ±Ùƒ ÙˆÙ‚ØªÙ‹Ø§ Ù„Ù„Ø¨Ø± ÙˆØµÙ„Ø© Ø§Ù„Ø±Ø­Ù….
              </div>
            </div>
          </div>
        </div>

        <!-- Teacher -->
        <div id="tab-teacher" class="tab-panel" style="display:none; margin-top:14px;">
          <div class="box">
            <div class="label">ÙÙƒØ±Ø© ØªØ±Ø¨ÙˆÙŠØ© Ù…Ø®ØªØµØ±Ø© ØªØ±Ø¨Ø· Ø§Ù„Ù…Ù‡Ø§Ø±Ø© Ø¨Ø§Ù„Ù‚ÙŠÙ…Ø©</div>
            <div class="muted">
              â€¢ Ø§Ø³Ø£Ù„: â€œÙƒÙŠÙ Ø£Ø¹Ø±Ù Ø£Ù†ÙŠ ÙˆØµÙ„Øª ÙÙŠ Ø§Ù„ÙˆÙ‚ØªØŸâ€ Ø«Ù… Ø§Ø±Ø¨Ø·Ù‡Ø§: Ø§Ù„ØµÙ„Ø§Ø© ÙˆØ§Ù„Ø¥ÙØ·Ø§Ø± Ù„Ø§ ÙŠÙ†ØªØ¸Ø±Ø§Ù†â€¦ Ø¥Ø°Ù† Ø£Ù†Øª Ù…Ù† ÙŠÙ†Ø¸Ù‘Ù… ÙŠÙˆÙ…Ù‡.<br>
              â€¢ Ø§Ø¬Ø¹Ù„ Ø§Ù„Ø·Ø§Ù„Ø¨ ÙŠÙ‚ÙˆÙ„: â€œØ³Ø£Ø¶Ø¹ ÙˆÙ‚ØªÙ‹Ø§ Ù„Ø¹Ø¨Ø§Ø¯ØªÙŠØŒ Ø«Ù… ÙˆÙ‚ØªÙ‹Ø§ Ù„ÙˆØ§Ø¬Ø¨ÙŠØŒ Ø«Ù… ÙˆÙ‚ØªÙ‹Ø§ Ù„Ø±Ø§Ø­ØªÙŠâ€.<br>
              â€¢ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ ÙƒÙ€ (Ù…Ø­Ø·Ø© ØªØ¹Ù„Ù…): ÙŠØ¬ÙŠØ¨ Ù¥ Ø£Ø³Ø¦Ù„Ø©ØŒ Ø«Ù… ÙŠÙ…Ù„Ø£ Ø¬Ø¯ÙˆÙ„ ÙŠÙˆÙ…Ù‡ Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠ.
            </div>
          </div>

          <div class="hr"></div>

          <div class="box">
            <div class="label">Ù†Øµ Ø¬Ø§Ù‡Ø² ØªÙ‚ÙˆÙ„Ù‡ Ù„Ù„Ø·Ù„Ø§Ø¨</div>
            <div class="muted" style="font-weight:800;">
              â€œÙÙŠ Ø±Ù…Ø¶Ø§Ù† Ù†ØªØ¹Ù„Ù… Ù‚ÙŠÙ…Ø© Ø¹Ø¸ÙŠÙ…Ø©: ÙˆÙ‚ØªÙŠ Ø£Ù…Ø§Ù†Ø©. Ø¥Ø°Ø§ Ø¹Ø±ÙØª Ø£Ù‚Ø±Ø£ Ø§Ù„Ø³Ø§Ø¹Ø© ØµØ­ØŒ Ø£Ù‚Ø¯Ø± Ø£Ù†Ø¸Ù‘Ù… Ø¹Ø¨Ø§Ø¯ØªÙŠ ÙˆÙ…Ø°Ø§ÙƒØ±ØªÙŠ ÙˆØ±Ø§Ø­ØªÙŠ.
              Ø§Ù„ÙŠÙˆÙ… Ø¨Ù†Ù„Ø¹Ø¨ Ù„Ø¹Ø¨Ø© Ø§Ù„Ø³Ø§Ø¹Ø©: ÙƒÙ„ Ù…Ù‡Ù…Ø© Ø±Ù…Ø¶Ø§Ù†ÙŠØ© Ù„Ù‡Ø§ ÙˆÙ‚Øªâ€¦ ÙˆØ£Ù†Øª ØªØ¶Ø¨Ø· Ø§Ù„Ø¹Ù‚Ø§Ø±Ø¨ ÙˆØªØ«Ø¨Øª Ø£Ù†Ùƒ Ù‚Ø¯Ù‘Ù‡Ø§!â€
            </div>
          </div>
        </div>
      </div>

      <!-- Right -->
      <div class="card">
        <div class="label">Ù„Ù…Ø§Ø°Ø§ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø¨Ø· Ù‚ÙˆÙŠØŸ</div>
        <p class="muted">
          Ù„Ø£Ù† Ø§Ù„Ø·Ø§Ù„Ø¨ ÙŠØ´ÙˆÙ Ø§Ù„Ø³Ø§Ø¹Ø© ÙÙŠ Ø³ÙŠØ§Ù‚ ÙˆØ§Ù‚Ø¹ÙŠ: (Ø³Ø­ÙˆØ±ØŒ ÙØ¬Ø±ØŒ Ù…Ø°Ø§ÙƒØ±Ø©ØŒ Ø¥ÙØ·Ø§Ø±â€¦)
          ÙÙŠØªØ¹Ù„Ù‘Ù… Ø£Ù† Ø§Ù„ÙˆÙ‚Øª Ù„ÙŠØ³ Ø£Ø±Ù‚Ø§Ù…Ù‹Ø§ ÙÙ‚Ø·ØŒ Ø¨Ù„ <b>Ø³Ù„ÙˆÙƒ ÙˆØ§Ù„ØªØ²Ø§Ù…</b>.
        </p>

        <div class="hr"></div>

        <div class="label">Ø·Ø±ÙŠÙ‚Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø³Ø±ÙŠØ¹Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙ</div>
        <div class="muted">
          Ù¡) Ø§Ø¹Ø±Ø¶ Ø£ÙˆÙ„ Ø³Ø¤Ø§Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¨ÙˆØ±Ø©.<br>
          Ù¢) Ø®Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙŠØ¶Ø¨Ø·ÙˆÙ† Ø§Ù„ÙˆÙ‚Øª ÙÙŠ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ (Ø¬Ù‡Ø§Ø²/Ù„ÙˆØ­/Ø­Ø§Ø³ÙˆØ¨).<br>
          Ù£) Ø¨Ø¹Ø¯ Ù¥ Ø£Ø³Ø¦Ù„Ø©: Ø§Ù†ØªÙ‚Ù„ Ù„ØªØ¨ÙˆÙŠØ¨ â€œØ¬Ø¯ÙˆÙ„ÙŠ Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠâ€.
        </div>

        <div class="hr"></div>

        <div class="label">Ù…Ù„Ø§Ø­Ø¸Ø© ØªÙ‚Ù†ÙŠØ©</div>
        <div class="muted">
          â€¢ ÙŠØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª Ø¨Ø¹Ø¯ ÙØªØ­Ù‡ Ù…Ø±Ø©.<br>
          â€¢ ÙŠØ­ÙØ¸ Ø£ÙØ¶Ù„ Ù†ØªÙŠØ¬Ø© ÙˆØ¬Ø¯ÙˆÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ø¬Ù‡Ø§Ø².<br>
          â€¢ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© ØªÙØ·Ø¨Ø¹ Ù…Ù† Ø²Ø± â€œØ´Ù‡Ø§Ø¯Ø© Ø¥Ù†Ø¬Ø§Ø²â€.
        </div>
      </div>
    </div>
  </div>

  <footer>
    <div>Â© <b>Ø£/ ÙØ§Ø·Ù…Ø© Ù‡Ø²Ø§Ø²ÙŠ</b> â€” Ù…Ù„ØªÙ‚Ù‰ Ù…Ø¹Ù„Ù…ÙŠ ÙˆÙ…Ø¹Ù„Ù…Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª â€” Ù…Ù„ØªÙ‚Ù‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ</div>
    <div class="mini">Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªØ¯Ø±ÙŠØ¨ÙŠ Ù…Ø¨Ø³Ø· Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø³Ø§Ø¹Ø© ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚Øª ÙÙŠ Ø±Ù…Ø¶Ø§Ù†</div>
  </footer>

  <!-- Certificate Modal -->
  <div class="modal" id="certModal" aria-hidden="true">
    <div class="cert" role="dialog" aria-modal="true" aria-label="Ø´Ù‡Ø§Ø¯Ø© Ø¥Ù†Ø¬Ø§Ø²">
      <div class="cert-head">
        <div class="cert-brand">
          <img id="certLogo" alt="Ø´Ø¹Ø§Ø±" />
          <div>
            <div style="font-weight:900; font-size:16px;">Ø´Ù‡Ø§Ø¯Ø© Ø¥Ù†Ø¬Ø§Ø²</div>
            <div class="mini">ÙˆÙ‚ØªÙŠ ÙÙŠ Ø±Ù…Ø¶Ø§Ù† â€” ØªØ¯Ø±ÙŠØ¨ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø³Ø§Ø¹Ø©</div>
          </div>
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <button class="btn ghost" id="printCert">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</button>
          <button class="btn" id="closeCert">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
      </div>

      <div class="cert-body">
        <h2 class="cert-title">Ø´Ù‡Ø§Ø¯Ø© Ø¥Ù†Ø¬Ø§Ø²</h2>
        <p class="cert-sub">
          ØªØ´Ù‡Ø¯ Ù‡Ø°Ù‡ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø¨Ø¥ØªÙ…Ø§Ù… Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØªØ­Ù‚ÙŠÙ‚ Ù†ØªÙŠØ¬Ø© ÙÙŠ Ù…Ù‡Ø§Ø±Ø© Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø³Ø§Ø¹Ø© ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚Øª ÙÙŠ Ø±Ù…Ø¶Ø§Ù†.
        </p>

        <div class="cert-name">Ø§Ù„Ø·Ø§Ù„Ø¨: <span id="certName">â€”</span></div>

        <div class="cert-grid">
          <div class="cert-kpi"><span>Ø§Ù„Ù†ØªÙŠØ¬Ø©</span><span id="certScore">â€”</span></div>
          <div class="cert-kpi"><span>Ø§Ù„ØªØ§Ø±ÙŠØ®</span><span id="certDate">â€”</span></div>
        </div>

        <div class="hr"></div>

        <div class="mini" style="font-weight:900;">
          Ø§Ù„Ù…Ø¹Ù„Ù…Ø©: Ø£/ ÙØ§Ø·Ù…Ø© Ù‡Ø²Ø§Ø²ÙŠ â€” Ù…Ù„ØªÙ‚Ù‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ
        </div>
      </div>

      <div class="cert-foot">
        <div class="cert-sign">Ù…Ù„ØªÙ‚Ù‰ Ù…Ø¹Ù„Ù…ÙŠ ÙˆÙ…Ø¹Ù„Ù…Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</div>
        <div class="cert-sign">Ø´Ù‡Ø§Ø¯Ø© ØªØ´Ø¬ÙŠØ¹ÙŠØ© ØªØ¹Ù„ÙŠÙ…ÙŠØ©</div>
      </div>
    </div>
  </div>

<script>
  /* ===== Ø´Ø¹Ø§Ø±Ùƒ (Ù…Ø¯Ù…Ø¬ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù„Ù) ===== */
  const LOGO_DATA_URI = "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/2wBDAAQDAwQDAwQEAwQFBAQFBgoHBgYGBg0JCggKDw0QEA8NDw4R" +
  "..." +
  "==";
  // Ù…Ù„Ø§Ø­Ø¸Ø©: ØªÙ… Ø§Ø®ØªØµØ§Ø± Ø§Ù„Ù†Øµ Ù‡Ù†Ø§ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø±Ø¶.
  // Ø¥Ø°Ø§ Ù†Ø³Ø®Øª Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† ChatGPT Ù…Ø¨Ø§Ø´Ø±Ø© Ø³ÙŠØ­ØªÙˆÙŠ Base64 ÙƒØ§Ù…Ù„.

  // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø´Ø¹Ø§Ø± ÙÙŠ Ø£Ù…Ø§ÙƒÙ†Ù‡
  const logoImg = document.getElementById("logoImg");
  const certLogo = document.getElementById("certLogo");
  logoImg.src = LOGO_DATA_URI;
  certLogo.src = LOGO_DATA_URI;

  // ===== Helpers: Arabic digits =====
  const AR_DIGITS = "Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©";
  const toArabicDigits = (s) => String(s).replace(/\d/g, d => AR_DIGITS[d]);
  const pad2 = (n) => String(n).padStart(2,"0");
  const clampHour12 = (h) => { let x = h % 12; if (x === 0) x = 12; return x; };

  // ===== Difficulty settings =====
  const DIFF = {
    hour:   { step:60, minutes:[0] },
    half:   { step:30, minutes:[0,30] },
    quarter:{ step:15, minutes:[0,15,30,45] },
    five:   { step:5,  minutes:[0,5,10,15,20,25,30,35,40,45,50,55] },
  };

  // ===== Scenario events (examples for learning) =====
  const EVENTS = [
    { label:"Ø§Ù„Ø³Ø­ÙˆØ±", hours:[3,4,5] },
    { label:"ØµÙ„Ø§Ø© Ø§Ù„ÙØ¬Ø± (Ù…Ø«Ø§Ù„)", hours:[4,5,6] },
    { label:"Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­", hours:[6,7,8] },
    { label:"Ù…Ø°Ø§ÙƒØ±Ø© Ù‚ØµÙŠØ±Ø©", hours:[8,9,10] },
    { label:"ØµÙ„Ø§Ø© Ø§Ù„Ø¸Ù‡Ø± (Ù…Ø«Ø§Ù„)", hours:[12,1] },
    { label:"Ù‚ÙŠÙ„ÙˆÙ„Ø©/Ø±Ø§Ø­Ø©", hours:[1,2] },
    { label:"ØµÙ„Ø§Ø© Ø§Ù„Ø¹ØµØ± (Ù…Ø«Ø§Ù„)", hours:[3,4,5] },
    { label:"Ù‚Ø±Ø§Ø¡Ø© Ù‚Ø±Ø¢Ù†", hours:[4,5] },
    { label:"Ø§Ù„Ø¥ÙØ·Ø§Ø± (Ù…Ø«Ø§Ù„)", hours:[6,7] },
    { label:"Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­ (Ù…Ø«Ø§Ù„)", hours:[8,9] },
  ];

  // ===== Defaults for plan tab =====
  const planDefaults = [
    { id:"suhoor", label:"Ø§Ù„Ø³Ø­ÙˆØ±", hour:4, minute:30 },
    { id:"fajr",   label:"ØµÙ„Ø§Ø© Ø§Ù„ÙØ¬Ø± (Ù…Ø«Ø§Ù„)", hour:5, minute:0 },
    { id:"quran",  label:"ÙˆØ±Ø¯ Ø§Ù„Ù‚Ø±Ø¢Ù†", hour:6, minute:15 },
    { id:"study",  label:"Ù…Ø°Ø§ÙƒØ±Ø©/ÙˆØ§Ø¬Ø¨", hour:9, minute:0 },
    { id:"dhuhr",  label:"ØµÙ„Ø§Ø© Ø§Ù„Ø¸Ù‡Ø± (Ù…Ø«Ø§Ù„)", hour:12, minute:30 },
    { id:"nap",    label:"Ù‚ÙŠÙ„ÙˆÙ„Ø©/Ø±Ø§Ø­Ø©", hour:1, minute:30 },
    { id:"asr",    label:"ØµÙ„Ø§Ø© Ø§Ù„Ø¹ØµØ± (Ù…Ø«Ø§Ù„)", hour:3, minute:30 },
    { id:"family", label:"Ø¨Ø± Ø§Ù„ÙˆØ§Ù„Ø¯ÙŠÙ†/ØµÙ„Ø© Ø§Ù„Ø±Ø­Ù…", hour:4, minute:30 },
    { id:"iftar",  label:"Ø§Ù„Ø¥ÙØ·Ø§Ø± (Ù…Ø«Ø§Ù„)", hour:6, minute:15 },
    { id:"tara",   label:"Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­ (Ù…Ø«Ø§Ù„)", hour:8, minute:0 },
  ];

  const state = {
    total: 10,
    qIndex: 0,
    score: 0,
    best: 0,
    target: null,
    setting: { hour: 12, minute: 0 },
    difficulty: "quarter",
    student: "",
    plan: [],
  };

  const el = (id) => document.getElementById(id);

  const tabs = document.querySelectorAll(".tab");
  const panels = { game: el("tab-game"), plan: el("tab-plan"), teacher: el("tab-teacher") };

  const hourHand = el("hourHand");
  const minuteHand = el("minuteHand");
  const digitalPreview = el("digitalPreview");
  const prompt = el("prompt");
  const hint = el("hint");
  const feedback = el("feedback");
  const qNow = el("qNow");
  const qTotal = el("qTotal");
  const scoreEl = el("score");
  const bestEl = el("best");

  const startBtn = el("startBtn");
  const resetBtn = el("resetBtn");
  const checkBtn = el("checkBtn");
  const nextBtn = el("nextBtn");
  const hourUp = el("hourUp");
  const hourDown = el("hourDown");
  const minUp = el("minUp");
  const minDown = el("minDown");
  const difficultySel = el("difficulty");
  const studentName = el("studentName");

  const certBtn = el("certBtn");
  const copyResultBtn = el("copyResult");
  const certModal = el("certModal");
  const closeCert = el("closeCert");
  const printCert = el("printCert");
  const certName = el("certName");
  const certScore = el("certScore");
  const certDate = el("certDate");

  function buildNumbers(){
    const cont = el("clockNumbers");
    cont.innerHTML = "";
    const clock = el("clock");
    const rect = clock.getBoundingClientRect();
    const size = Math.min(rect.width, rect.height);
    const center = size/2;
    const r = size * 0.38;

    for(let i=1;i<=12;i++){
      const div = document.createElement("div");
      div.className = "num";
      div.textContent = toArabicDigits(i);
      const angle = (i * 30 - 90) * Math.PI / 180;
      const x = center + r * Math.cos(angle);
      const y = center + r * Math.sin(angle);
      div.style.left = x + "px";
      div.style.top  = y + "px";
      cont.appendChild(div);
    }
  }

  function formatTime(h,m){ return toArabicDigits(`${pad2(h)}:${pad2(m)}`); }

  function updateClock(){
    const h = clampHour12(state.setting.hour);
    const m = state.setting.minute;
    const hourAngle = (h % 12) * 30 + (m/60) * 30;
    const minAngle = m * 6;

    hourHand.style.transform   = `translate(-50%,-100%) rotate(${hourAngle}deg)`;
    minuteHand.style.transform = `translate(-50%,-100%) rotate(${minAngle}deg)`;
    digitalPreview.textContent = formatTime(h, m);
  }

  function setFeedback(msg, kind=""){
    feedback.classList.remove("ok","bad");
    if(kind) feedback.classList.add(kind);
    feedback.textContent = msg;
  }

  function loadBest(){
    const k = "ramadan_clock_best";
    const v = Number(localStorage.getItem(k) || 0);
    state.best = isFinite(v) ? v : 0;
    bestEl.textContent = toArabicDigits(state.best);
  }
  function saveBest(){
    localStorage.setItem("ramadan_clock_best", String(state.best));
    bestEl.textContent = toArabicDigits(state.best);
  }

  function loadStudent(){
    const v = localStorage.getItem("ramadan_clock_student") || "";
    state.student = v;
    studentName.value = v;
  }
  function saveStudent(){ localStorage.setItem("ramadan_clock_student", state.student || ""); }

  function pickQuestion(){
    const diff = DIFF[state.difficulty];
    const event = EVENTS[Math.floor(Math.random() * EVENTS.length)];
    const hour = event.hours[Math.floor(Math.random() * event.hours.length)];
    const minute = diff.minutes[Math.floor(Math.random() * diff.minutes.length)];
    state.target = { event: event.label, hour: clampHour12(hour), minute };
    prompt.innerHTML = `Ø§Ø¶Ø¨Ø· Ø§Ù„Ø³Ø§Ø¹Ø© Ø¹Ù„Ù‰ ÙˆÙ‚Øª: <b>${state.target.event}</b> â€” <b>${formatTime(state.target.hour, state.target.minute)}</b>`;
    hint.textContent = "ØªÙ„Ù…ÙŠØ­: Ø­Ø±Ù‘Ùƒ Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ Ø­ØªÙ‰ ÙŠØµÙ„ Ø§Ù„Ø¹Ù‚Ø±Ø¨ Ø§Ù„Ø·ÙˆÙŠÙ„ Ù„Ù„Ù…ÙƒØ§Ù† Ø§Ù„ØµØ­ÙŠØ­.";
  }

  function resetSetting(){
    state.setting.hour = 12;
    state.setting.minute = 0;
    updateClock();
  }

  function startGame(){
    state.qIndex = 0;
    state.score = 0;
    scoreEl.textContent = toArabicDigits(state.score);
    qTotal.textContent = toArabicDigits(state.total);

    certBtn.style.display = "none";
    copyResultBtn.style.display = "none";

    checkBtn.disabled = false;
    nextBtn.disabled = true;

    resetSetting();
    nextQuestion(true);
  }

  function nextQuestion(first=false){
    if(!first && state.qIndex >= state.total){
      endGame();
      return;
    }
    state.qIndex += 1;
    qNow.textContent = toArabicDigits(state.qIndex);

    pickQuestion();
    setFeedback("Ø§Ø¶Ø¨Ø· Ø§Ù„Ø¹Ù‚Ø§Ø±Ø¨ Ø«Ù… Ø§Ø¶ØºØ· â€œØªØ­Ù‚Ù‚â€.");
    nextBtn.disabled = true;
    checkBtn.disabled = false;
  }

  function checkAnswer(){
    if(!state.target) return;

    const sh = clampHour12(state.setting.hour);
    const sm = state.setting.minute;
    const ok = (sh === state.target.hour) && (sm === state.target.minute);

    if(ok){
      state.score += 1;
      scoreEl.textContent = toArabicDigits(state.score);
      setFeedback(`Ø£Ø­Ø³Ù†Øª! âœ… Ø§Ù„ÙˆÙ‚Øª ØµØ­ÙŠØ­: ${formatTime(sh, sm)}.`, "ok");
    }else{
      setFeedback(`Ù„ÙŠØ³ ØªÙ…Ø§Ù…Ù‹Ø§ âŒ Ø§Ø®ØªØ±Øª ${formatTime(sh, sm)} â€” Ø§Ù„ØµØ­ÙŠØ­ ${formatTime(state.target.hour, state.target.minute)}.`, "bad");
    }

    checkBtn.disabled = true;
    nextBtn.disabled = false;
    nextBtn.textContent = (state.qIndex >= state.total) ? "Ø¥Ù†Ù‡Ø§Ø¡" : "Ø§Ù„ØªØ§Ù„ÙŠ";
  }

  function endGame(){
    const name = (state.student || "Ø·Ø§Ù„Ø¨");
    let msg = `Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙŠØ§ ${name}! Ù†ØªÙŠØ¬ØªÙƒ: ${toArabicDigits(state.score)} Ù…Ù† ${toArabicDigits(state.total)}.`;
    if(state.score > state.best){
      state.best = state.score;
      saveBest();
      msg += " ğŸ‰ Ù‡Ø°Ø§ Ø£ÙØ¶Ù„ Ø±Ù‚Ù… Ù„Ùƒ!";
      setFeedback(msg, "ok");
    }else{
      setFeedback(msg, "");
    }
    prompt.innerHTML = `ğŸ¯ Ø§Ù†ØªÙ‡ÙŠØª! Ø¬Ø±Ù‘Ø¨ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ© ÙˆØ®Ù„Ù‘ ÙˆÙ‚ØªÙƒ Ù…Ù†Ø¸Ù…Ù‹Ø§ ÙÙŠ Ø±Ù…Ø¶Ø§Ù†.`;

    checkBtn.disabled = true;
    nextBtn.disabled = true;

    certBtn.style.display = "inline-block";
    copyResultBtn.style.display = "inline-block";
  }

  function changeDifficulty(v){
    state.difficulty = v;
    const allowed = DIFF[state.difficulty].minutes;
    if(!allowed.includes(state.setting.minute)){ state.setting.minute = allowed[0]; }
    updateClock();
    renderPlan();
  }

  function hourInc(){ state.setting.hour = clampHour12(state.setting.hour + 1); updateClock(); }
  function hourDec(){ state.setting.hour = clampHour12(state.setting.hour - 1); updateClock(); }
  function minuteInc(){
    const step = DIFF[state.difficulty].step;
    if(step >= 60){ state.setting.minute = 0; updateClock(); return; }
    state.setting.minute = (state.setting.minute + step) % 60;
    updateClock();
  }
  function minuteDec(){
    const step = DIFF[state.difficulty].step;
    if(step >= 60){ state.setting.minute = 0; updateClock(); return; }
    state.setting.minute = (state.setting.minute - step + 60) % 60;
    updateClock();
  }

  function activateTab(name){
    tabs.forEach(t => t.classList.toggle("active", t.dataset.tab === name));
    Object.keys(panels).forEach(k => panels[k].style.display = (k===name) ? "block" : "none");
    if(name === "plan") renderPlan();
    if(name === "game") setTimeout(buildNumbers, 50);
  }
  tabs.forEach(t => t.addEventListener("click", () => activateTab(t.dataset.tab)));

  function loadPlan(){
    const raw = localStorage.getItem("ramadan_clock_plan");
    if(raw){
      try{
        const data = JSON.parse(raw);
        if(Array.isArray(data) && data.length){
          state.plan = data.map(x => ({
            id: x.id || ("id_" + Math.random().toString(16).slice(2)),
            label: x.label || "Ù†Ø´Ø§Ø·",
            hour: clampHour12(Number(x.hour || 12)),
            minute: Number(x.minute || 0),
          }));
          return;
        }
      }catch(e){}
    }
    state.plan = planDefaults.map(x => ({...x}));
  }

  function savePlan(){
    localStorage.setItem("ramadan_clock_plan", JSON.stringify(state.plan));
    setFeedback("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¬Ø¯ÙˆÙ„ âœ… ÙŠÙ…ÙƒÙ†Ùƒ Ø·Ø¨Ø§Ø¹ØªÙ‡ Ø§Ù„Ø¢Ù†.", "ok");
  }

  function renderPlan(){
    const tbody = document.querySelector("#planTable tbody");
    if(!tbody) return;
    tbody.innerHTML = "";

    const minutesAllowed = DIFF[state.difficulty].minutes;
    const hourOptions = Array.from({length:12}, (_,i)=>i+1);

    state.plan.forEach((row, idx) => {
      const tr = document.createElement("tr");

      const tdLabel = document.createElement("td");
      tdLabel.innerHTML = `<b>${row.label}</b>`;
      tr.appendChild(tdLabel);

      const tdH = document.createElement("td");
      const selH = document.createElement("select");
      selH.className = "select";
      hourOptions.forEach(h => {
        const opt = document.createElement("option");
        opt.value = h;
        opt.textContent = toArabicDigits(h);
        if(h === clampHour12(row.hour)) opt.selected = true;
        selH.appendChild(opt);
      });
      selH.addEventListener("change", (e) => { state.plan[idx].hour = clampHour12(Number(e.target.value)); });
      tdH.appendChild(selH);
      tr.appendChild(tdH);

      const tdM = document.createElement("td");
      const selM = document.createElement("select");
      selM.className = "select";
      minutesAllowed.forEach(m => {
        const opt = document.createElement("option");
        opt.value = m;
        opt.textContent = toArabicDigits(pad2(m));
        if(m === Number(row.minute)) opt.selected = true;
        selM.appendChild(opt);
      });
      if(!minutesAllowed.includes(Number(row.minute))){ state.plan[idx].minute = minutesAllowed[0]; }
      selM.addEventListener("change", (e) => { state.plan[idx].minute = Number(e.target.value); });
      tdM.appendChild(selM);
      tr.appendChild(tdM);

      tbody.appendChild(tr);
    });
  }

  // ===== Certificate =====
  function openCertificate(){
    const name = (state.student || "Ø·Ø§Ù„Ø¨");
    const today = new Date();
    const dateStr = `${toArabicDigits(today.getFullYear())}/${toArabicDigits(pad2(today.getMonth()+1))}/${toArabicDigits(pad2(today.getDate()))}`;
    certName.textContent = name;
    certScore.textContent = `${toArabicDigits(state.score)} / ${toArabicDigits(state.total)}`;
    certDate.textContent = dateStr;

    certModal.classList.add("show");
    certModal.setAttribute("aria-hidden","false");
  }
  function closeCertificate(){
    certModal.classList.remove("show");
    certModal.setAttribute("aria-hidden","true");
  }

  async function copyResult(){
    const name = (state.student || "Ø·Ø§Ù„Ø¨");
    const text = `Ù†ØªÙŠØ¬Ø© ${name}: ${state.score}/${state.total} ÙÙŠ Ø¨Ø±Ù†Ø§Ù…Ø¬ (ÙˆÙ‚ØªÙŠ ÙÙŠ Ø±Ù…Ø¶Ø§Ù† â€” ØªØ¯Ø±ÙŠØ¨ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø³Ø§Ø¹Ø©).`;
    try{
      await navigator.clipboard.writeText(text);
      setFeedback("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø© âœ…", "ok");
    }catch(e){
      // Ø¨Ø¯ÙŠÙ„ Ø¥Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­ Ù…Ù†Ø¹ Ø§Ù„Ù†Ø³Ø®
      window.prompt("Ø§Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø©:", text);
    }
  }

  function init(){
    loadBest();
    loadStudent();
    loadPlan();

    setTimeout(buildNumbers, 50);
    updateClock();

    difficultySel.addEventListener("change", e => changeDifficulty(e.target.value));
    studentName.addEventListener("input", e => { state.student = e.target.value.trim(); saveStudent(); });

    startBtn.addEventListener("click", startGame);
    resetBtn.addEventListener("click", () => { resetSetting(); setFeedback("ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø·."); });
    checkBtn.addEventListener("click", checkAnswer);

    nextBtn.addEventListener("click", () => {
      if(state.qIndex >= state.total){ endGame(); }
      else { nextQuestion(false); }
    });

    hourUp.addEventListener("click", hourInc);
    hourDown.addEventListener("click", hourDec);
    minUp.addEventListener("click", minuteInc);
    minDown.addEventListener("click", minuteDec);

    el("savePlan").addEventListener("click", savePlan);
    el("printPlan").addEventListener("click", () => window.print());

    certBtn.addEventListener("click", openCertificate);
    closeCert.addEventListener("click", closeCertificate);
    printCert.addEventListener("click", () => window.print());
    copyResultBtn.addEventListener("click", copyResult);

    certModal.addEventListener("click", (e) => { if(e.target === certModal) closeCertificate(); });

    state.difficulty = difficultySel.value;
    changeDifficulty(state.difficulty);

    window.addEventListener("resize", () => setTimeout(buildNumbers, 60));
  }

  document.addEventListener("DOMContentLoaded", init);
</script>
</body>
</html>